branches:
  only:
  - travis

language: node_js
node_js:
  - 12

os: linux
dist: focal

arch:
  - s390x
  - amd64

services:
  - docker

env:
  global:
    - NODE_VERSION="12"
    - CDN_PREFIX: https://static.developers.redhat.com/che/theia_artifacts/
    - MONACO_CDN_PREFIX: https://cdn.jsdelivr.net/npm/
script:
  # Build image
  - docker image prune -a -f 
  - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
  - docker login quay.io -u="$QUAY_USERNAME " -p="$QUAY_PASSWORD"
  - ./build.sh --root-yarn-opts:--ignore-scripts --dockerfile:Dockerfile.alpine 
  - printf "//registry.npmjs.org/:_authToken=${{ secrets.CHE_NPM_AUTH_TOKEN }}\n" >> ~/.npmrc
  - yarn publish:next
